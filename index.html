<!DOCTYPE html>
<html>
<head>
    <title>Classificação de Cabelos</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/4.12.0/tf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow-models/mobilenet/1.0.0/index.min.js"></script>
</head>
<body>
    <div style="max-width: 800px; margin: 0 auto; padding: 20px;">
        <h1>Classificação de Cabelos</h1>
        <input type="file" id="imageUpload" accept="image/*">
        <div style="margin: 20px 0;">
            <img id="preview" style="max-width: 100%; display: none;">
        </div>
        <div id="result" style="margin-top: 20px; font-size: 18px;"></div>
    </div>

    <script>
        let model;
        let classes;

        async function carregarModelo() {
            try {
                model = await tf.loadLayersModel('web_model/model.json');
                const response = await fetch('classes.json');
                classes = await response.json();
                console.log('Modelo e classes carregados com sucesso');
            } catch (error) {
                console.error('Erro ao carregar o modelo:', error);
            }
        }

        async function classificarImagem(image) {
            // Pré-processar a imagem
            const tensor = tf.browser.fromPixels(image)
                .resizeNearestNeighbor([224, 224])
                .toFloat()
                .div(255.0)
                .expandDims();

            // Obter previsões
            const predictions = await model.predict(tensor).data();
            const results = Array.from(predictions)
                .map((prob, i) => ({
                    class: classes[i],
                    probability: prob * 100
                }))
                .sort((a, b) => b.probability - a.probability);

            return results;
        }

        // Carregar modelo quando a página carregar
        carregarModelo();

        // Lidar com upload de imagem
        document.getElementById('imageUpload').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // Mostrar preview
            const preview = document.getElementById('preview');
            preview.src = URL.createObjectURL(file);
            preview.style.display = 'block';

            // Esperar imagem carregar
            preview.onload = async () => {
                const results = await classificarImagem(preview);
                
                // Mostrar resultados
                const resultDiv = document.getElementById('result');
                resultDiv.innerHTML = results.map(r => 
                    `<div>${r.class}: ${r.probability.toFixed(2)}%</div>`
                ).join('');
            };
        });
    </script>
</body>
</html>